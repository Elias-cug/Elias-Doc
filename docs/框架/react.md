# React

## ç”Ÿå‘½å‘¨æœŸ

**è¿‡ç¨‹â€”â€”â€”â€”åˆå§‹åŒ–é˜¶æ®µ**

1. getDefaultProps:è·å–å®ä¾‹çš„é»˜è®¤å±æ€§
2. getInitialState:è·å–æ¯ä¸ªå®ä¾‹çš„åˆå§‹åŒ–çŠ¶æ€
3. componentWillMountï¼šç»„ä»¶å³å°†è¢«è£…è½½ã€æ¸²æŸ“åˆ°é¡µé¢ä¸Š
4. render:ç»„ä»¶åœ¨è¿™é‡Œç”Ÿæˆè™šæ‹Ÿçš„ DOM èŠ‚ç‚¹
5. componentDidMount:ç»„ä»¶çœŸæ­£åœ¨è¢«è£…è½½ä¹‹å

**è¿è¡Œä¸­çŠ¶æ€**

1. componentWillReceiveProps:ç»„ä»¶å°†è¦æ¥æ”¶åˆ°å±æ€§çš„æ—¶å€™è°ƒç”¨
2. shouldComponentUpdate:ç»„ä»¶æ¥å—åˆ°æ–°å±æ€§æˆ–è€…æ–°çŠ¶æ€çš„æ—¶å€™ï¼ˆå¯ä»¥è¿”å› falseï¼Œæ¥æ”¶æ•°æ®åä¸æ›´æ–°ï¼Œé˜»æ­¢ render è°ƒç”¨ï¼Œåé¢çš„å‡½æ•°ä¸ä¼šè¢«ç»§ç»­æ‰§è¡Œäº†ï¼‰
3. componentWillUpdate:ç»„ä»¶å³å°†æ›´æ–°ä¸èƒ½ä¿®æ”¹å±æ€§å’ŒçŠ¶æ€
4. render:ç»„ä»¶é‡æ–°æç»˜
5. componentDidUpdate:ç»„ä»¶å·²ç»æ›´æ–°

**é”€æ¯é˜¶æ®µ**

1. componentWillUnmount:ç»„ä»¶å³å°†é”€æ¯

**æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ**

1. ä½¿ç”¨ getDerivedStateFromProps æ›¿æ¢ componentWillMount
2. ä½¿ç”¨ getSnapshotBeforeUpdate æ›¿æ¢ componentWillUpdate
3. é¿å…ä½¿ç”¨ componentWillReceiveProps

> å…¶å®è¯¥å˜åŠ¨çš„åŸå› æ­£æ˜¯ç”±äºä¸Šè¿°æåˆ°çš„ Fiberã€‚é¦–å…ˆä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“ React å¯ä»¥åˆ†æˆ reconciliation ä¸ commit ä¸¤ä¸ªé˜¶æ®µ> å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹:

reconciliation:

1. componentWillMount
2. componentWillReceiveProps
3. shouldComponentUpdate
4. componentWillUpdate

commit:

1. componentDidMount
2. componentDidUpdate
3. componentWillUnmount

## React ä¸­ refs çš„ä½œç”¨æ˜¯ä»€ä¹ˆ
1. è·å–å­ç»„ä»¶å®ä¾‹ï¼Œæ“ä½œå­ç»„ä»¶çš„ä¸€äº›æ–¹æ³•
2. åšæŒä¹…åŒ–å­˜å‚¨

## ç»„ä»¶é€šä¿¡

1. çˆ¶å­ç»„ä»¶é€šä¿¡
   çˆ¶ç»„ä»¶é€šè¿‡å‘å­ç»„ä»¶ä¼ é€’ props

2. å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡
   çˆ¶ç»„ä»¶å°†ä¸€ä¸ªå‡½æ•°ä½œä¸º props ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶è°ƒç”¨å›è°ƒå‡½æ•°

3. è·¨çº§ç»„ä»¶é€šä¿¡
   a) ä¸­é—´ç»„ä»¶å±‚å±‚ä¼ é€’ props
   b) ğŸ ä½¿ç”¨ context å¯¹è±¡

4. éåµŒå¥—ç»„ä»¶é—´é€šä¿¡
   a) åˆ©ç”¨äºŒè€…å…±åŒçˆ¶ç»„ä»¶çš„ context è¿›è¡Œé€šä¿¡
   b) ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶çš„æ–¹å¼

5. ä½¿ç”¨ redux è¿›è¡Œé€šä¿¡

## context ä½¿ç”¨

```js
// 1. åˆ›å»ºå¹¶å¯¼å‡º context å¯¹è±¡
export const { Provider, Consumer } = React.createContext({})

// 2. å¯¼å…¥å¹¶ä½¿ç”¨å‡½æ•°è·å–è¦æ¶ˆè´¹çš„çŠ¶æ€

// 3. hookä¸‹ä½¿ç”¨ useContext è·å–è¦æ¶ˆè´¹çš„çŠ¶æ€
```

## hook ä¸‹æ€ä¹ˆä½¿ç”¨ ShouldComponentUpdate
ä½¿ç”¨React.memoåŒ…è£¹ç»„ä»¶

## reactä¸­å‡½æ•°ç»„ä»¶ä¸ç±»ç»„ä»¶çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ
1. å‡½æ•°ç»„ä»¶æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªpropså¯¹è±¡è¿”å›ä¸€ä¸ªreactå…ƒç´ ï¼›è€Œç±»ç»„ä»¶éœ€è¦å»ç»§æ‰¿React.Componentå¹¶ä¸”åˆ›å»ºrenderå‡½æ•°è¿”å›reactå…ƒç´ 
2. å‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€stateï¼Œè€Œç±»ç»„ä»¶æœ‰

## PureComponent Component åŒºåˆ«

1. å‡ ä¹ç›¸åŒï¼Œä½†æ˜¯ PureComponent é€šè¿‡ prop å’Œ state çš„æµ…æ¯”è¾ƒæ¥å®ç°

## ä½¿ç”¨ React çš„ä¸€äº›å‘ç‚¹
1. JSX åšè¡¨è¾¾å¼åˆ¤æ–­æ—¶å€™éœ€è¦å¼ºè½¬ä¸º boolean
2. å°½é‡ä¸è¦åœ¨ componentWillReviceProps é‡Œä½¿ç”¨ setState å¦‚æœä¸€å®šè¦ä½¿ç”¨é‚£ä¹ˆéœ€è¦åˆ¤æ–­ç»“æŸæ¡ä»¶ä¸ç„¶ä¼šå‡ºç°æ— é™é‡æ¸²æŸ“å¯¼è‡´é¡µé¢å´©æºƒ
3. ç»™ç»„ä»¶æ·»åŠ  ref æ—¶å€™å°½é‡ä¸è¦ä½¿ç”¨åŒ¿åå‡½æ•°å› ä¸ºå½“ç»„ä»¶æ›´æ–°çš„æ—¶å€™åŒ¿åå‡½æ•°ä¼šè¢«å½“åšæ–°çš„ prop å¤„ç†è®© ref å±æ€§æ¥å—åˆ°æ–°å‡½æ•°çš„æ—¶å€™ react å†…éƒ¨ä¼šå…ˆæ¸…ç©º ref ä¹Ÿå°±æ˜¯ä¼šä»¥ null ä¸ºå›è°ƒå‚æ•°å…ˆæ‰§è¡Œä¸€æ¬¡ ref è¿™ä¸ª props ç„¶ååœ¨ä»¥è¯¥ç»„ä»¶çš„å®ä¾‹æ‰§è¡Œä¸€æ¬¡ ref æ‰€ä»¥ç”¨åŒ¿åå‡½æ•°åš ref çš„æ—¶å€™æœ‰çš„æ—¶å€™å» ref èµ‹å€¼åçš„å±æ€§ä¼šå–åˆ° null
4. éå†å­èŠ‚ç‚¹çš„æ—¶å€™ä¸è¦ç”¨ index ä½œä¸ºç»„ä»¶çš„ key è¿›è¡Œä¼ å…¥

## react class æ„å»ºæ—¶ï¼Œsuper(props)çš„ä½œç”¨
ä¸ºäº†ä½¿ å­ç»„ä»¶ä¸­å¯ä»¥ä½¿ç”¨ this.props è°ƒç”¨çˆ¶ç»„ä»¶ä¼ é€’çš„ propsã€‚

## è°ƒç”¨ setState ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆ

1. å°†è¦æ›´æ–°çš„ state å‹å…¥ä¸€ä¸ªå¾…æ›´æ–°é˜Ÿåˆ—ï¼ˆå³å†…éƒ¨å®ä¾‹çš„_pendingStateQueueï¼‰
2. æ‰§è¡Œå…¥æ ˆæ›´æ–°æ“ä½œ enqueueUpdate, åˆ¤æ–­æ˜¯å¦å¤„äºæ‰¹é‡æ›´æ–°çŠ¶æ€
3. å¦‚è‹¥æ­£å¤„äºæ›´æ–°ï¼Œé‚£ä¹ˆå°±å…ˆæŠŠå®ä¾‹æ¨è¿› dirtyComponents é‡Œç­‰å¾…ä¸‹ä¸€æ¬¡æ‰¹é‡æ›´æ–°
4. å¦‚æœæ²¡æœ‰æ‰¹é‡æ›´æ–°æ­£åœ¨æ‰§è¡Œï¼Œåˆ™ä¼šè°ƒç”¨ä¸€ä¸ªæ‰¹é‡æ›´æ–°ä»»åŠ¡

1. åœ¨ä»£ç ä¸­è°ƒç”¨ setState å‡½æ•°ä¹‹åï¼ŒReactä¼šå°†ä¼ å…¥çš„å‚æ•°å¯¹è±¡è¯­ç»„ä»¶å½“å‰çš„çŠ¶æ€åˆå¹¶ï¼Œç„¶åè§¦å‘è°ƒå’Œè¿‡ç¨‹ã€‚ç»è°ƒå’Œè¿‡ç¨‹å§ï¼ŒReact ä¼šä»¥ç›¸å¯¹é«˜æ•ˆçš„æ–¹å¼æ ¹æ®æ–°çš„çŠ¶æ€æ„å»º React å…ƒç´ æ ‘å¹¶ä¸”ç€æ‰‹é‡æ–°æ¸²æŸ“æ•´ä¸ª UI ç•Œé¢ã€‚åœ¨ React å¾—åˆ°å…ƒç´ æ ‘ä¹‹åï¼ŒReact ä¼šè‡ªåŠ¨è®¡ç®—å‡ºæ–°çš„æ ‘è¯­è€æ ‘çš„èŠ‚ç‚¹å·®å¼‚å¯¹ç•Œé¢è¿›è¡Œæœ€å°åŒ–é‡æ¸²æŸ“ã€‚åœ¨å·®å¼‚è®¡ç®—ç®—æ³•ä¸­ï¼ŒReact èƒ½å¤Ÿç›¸å¯¹ç²¾ç¡®åœ°çŸ¥é“å“ªäº›ä½ç½®å‘ç”Ÿäº†æ”¹å˜ä»¥åŠåº”è¯¥å¦‚ä½•æ”¹å˜ï¼Œè¿™å°±ä¿è¯äº†æŒ‰éœ€æ›´æ–°ï¼Œè€Œä¸æ˜¯å…¨éƒ¨é‡æ–°æ¸²æŸ“ã€‚å¦‚æœåœ¨çŸ­æ—¶é—´å†…é¢‘ç¹setStateï¼ŒReact ä¼šå°†stateçš„æ”¹å˜å‹å…¥æ ˆä¸­ï¼Œåœ¨åˆé€‚çš„æ—¶æœºï¼Œæ‰¹é‡æ›´æ–°stateå’Œè§†å›¾ï¼Œè¾¾åˆ°æé«˜æ€§èƒ½æ•ˆæœã€‚

## setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥
**åŒæ­¥**
1. é¦–å…ˆåœ¨legacyæ¨¡å¼ä¸‹
2. åœ¨æ‰§è¡Œä¸Šä¸‹é—®ä¸ºç©ºçš„æ—¶å€™å»è°ƒç”¨setState 
    - å¯ä»¥ä½¿ç”¨ä¸€æ­¥è°ƒç”¨setTimeout, Promise, MessageChannelç­‰
    - å¯ä»¥ç›‘å¬åŸç”Ÿäº‹ä»¶ï¼Œæ³¨æ„ä¸æ˜¯åˆæˆäº‹ä»¶ï¼Œåœ¨åŸç”Ÿäº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡ŒsetStateå°±æ˜¯åŒæ­¥çš„

**å¼‚æ­¥**
1. å¦‚æœæ˜¯åˆæˆäº‹ä»¶ä¸­çš„å›è°ƒï¼ŒexecutionContext !== DiscreteEventContextï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ï¼Œæœ€ç»ˆè¡¨ç°å‡ºå¼‚æ­¥
2. concurrentæ¨¡å¼ä¸‹éƒ½ä¸ºå¼‚æ­¥

## setState ä¸ç”Ÿå‘½å‘¨æœŸ
1. constructor ä¸­ä¸éœ€è¦ä½¿ç”¨ state
2. componentWillMount ä¸­åŒæ­¥çš„æ— ç”¨ï¼Œå¼‚æ­¥å¯ç”¨äºè·å–é¡µé¢çš„åˆå§‹æ•°æ®
3. render shouldComponentUpdate ç»„ä»¶è¿˜æ²¡æ¸²æŸ“ç»“æŸå°±ç»§ç»­è°ƒç”¨ setState ä¼šæ— é™è§¦å‘æ›´æ–°
4. å¯ä»¥ç”¨ setState çš„å£°æ˜å‘¨æœŸå‡½æ•°æœ‰ï¼ŒcomponentDidMountï¼ŒcomponentWillReceivePropsï¼ˆgetDerivedStateFromPropsï¼‰ï¼ŒcomponentDidUpdateï¼ˆæ³¨æ„æ­»å¾ªç¯ï¼‰

## react ä¸­ key çš„ä½œç”¨æ˜¯ä»€ä¹ˆ
**å•èŠ‚ç‚¹**
1. keyæ˜¯å•èŠ‚ç‚¹æ˜¯å¦å¤ç”¨çš„ç¬¬ä¸€åˆ¤æ–­æ¡ä»¶ï¼ˆç¬¬äºŒåˆ¤æ–­æ¡ä»¶æ˜¯typeæ˜¯å¦æ”¹å˜ï¼‰ï¼Œå¦‚æœkeyä¸åŒå…¶ä»–æ¡ä»¶æ˜¯å®Œå…¨ä¸çœ‹çš„
2. åœ¨æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œkeyéšç€elementå¯¹è±¡è¢«ä¼ å…¥fiberçš„æ„é€ å‡½æ•°
> æ‰€ä»¥è¿™é‡Œæ‰æ˜¯keyçš„æ ¸å¿ƒä½œç”¨ï¼Œæ˜¯è°ƒå’Œå‡½æ•°ä¸­ï¼Œé’ˆå¯¹å•ä¸€èŠ‚ç‚¹æ˜¯å¦å¯ä»¥å¤ç”¨çš„ç¬¬ä¸€åˆ¤æ–­æ¡ä»¶ï¼›å¯¹ä¸å•èŠ‚ç‚¹æ¥è®²keyæ˜¯å¯ä»¥çœç•¥çš„ï¼Œreactå†…éƒ¨é»˜è®¤ä¼šè®¾ç½®æˆé»˜è®¤å€¼nullï¼Œåœ¨è¿›è¡Œdiffæ—¶ç”±äºnull === null ä¸º trueï¼Œå‰årenderçš„keyæ—¶ä¸€è‡´çš„ï¼Œå¯ä»¥è¿›è¡Œå¤ç”¨æ¯”è¾ƒï¼›å¦‚æœå•èŠ‚ç‚¹æ˜¾ç¤ºçš„è®¾ç½®äº†keyï¼Œä¸”ä¸¤æ¬¡renderæ—¶çš„keyå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ— æ³•å¤ç”¨

**å¤šèŠ‚ç‚¹**
1. æ–°é˜Ÿåˆ—newChildrenä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå³reactElementå¯¹è±¡ï¼‰éƒ½éœ€è¦åŒæ—§é˜Ÿåˆ—oldFiberä¸­æœ‰ç›¸åŒkeyå€¼çš„å¯¹è±¡ï¼ˆå³oldFiberå¯¹è±¡ï¼‰è¿›è¡Œæ˜¯å¦å¯å¤ç”¨çš„æ¯”è¾ƒã€‚keyå°±æ˜¯å¿ƒå°±å¯¹è±¡èƒ½å¤Ÿå¯¹åº”èµ·æ¥çš„å”¯ä¸€æ ‡è¯†
2. å¦‚æœçœç•¥keyæˆ–è€…ç›´æ¥ä½¿ç”¨åˆ—è¡¨indexä½œä¸ºkeyï¼Œè¡¨ç°æ˜¯ä¸€æ ·çš„ï¼ˆkey=nullæ—¶ï¼Œä¼šé‡‡ç”¨indexä»£æ›¿keyè¿›è¡Œæ¯”è¾ƒï¼‰ã€‚åœ¨æ–°æ—§å¯¹è±¡æ¯”è¾ƒæ—¶ï¼Œåªèƒ½æŒ‰ç…§indexé¡ºåºè¿›è¡Œæ¯”è¾ƒï¼Œå¤ç”¨çš„æˆåŠŸç‡å¤§å¤§é™ä½ï¼Œå¤§åˆ—è¡¨ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚

> åœ¨reactä¸­keyæ˜¯æœåŠ¡äºdiffç®—æ³•ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯nullï¼Œåœ¨diffç®—æ³•è¿‡ç¨‹ä¸­ï¼Œæ–°æ—§èŠ‚ç‚¹æ˜¯å¦å¯ä»¥å¤ç”¨ï¼Œé¦–å…ˆä¼šåˆ¤å®škeyæ˜¯å¦ç›¸åŒï¼Œå…¶åæ‰ä¼šè¿›è¡Œå…¶ä»–æ¡ä»¶çš„åˆ¤å®šã€‚åœ¨æºç ä¸­é’ˆå¯¹å¤šèŠ‚ç‚¹ï¼ˆå³åˆ—è¡¨ç»„ä»¶ï¼‰å¦‚æœç›´æ¥å°†keyè®¾ç½®æˆindexå’Œä¸è®¾ç½®ä»»ä½•å€¼çš„å¤„ç†æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä½¿ç”¨ä¸å½“è½»åˆ™é€ æˆæ€§èƒ½æŸè€—ï¼Œé‡åˆ™å¼•èµ·çŠ¶æ€æ··ä¹±é€ æˆbugã€‚

## æ¦‚è¿°ä¸‹ React ä¸­çš„äº‹ä»¶å¤„ç†é€»è¾‘
ä¸ºäº†è§£å†³è·¨æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ React ä¼šå°†æµè§ˆå™¨åŸç”Ÿäº‹ä»¶ Browser Native Event å°è£…ä¸ºåˆæˆäº‹ä»¶ SyntheticEvent ä¼ å…¥è®¾ç½®çš„äº‹ä»¶å¤„ç†å™¨ä¸­ã€‚è¿™é‡Œçš„åˆæˆäº‹ä»¶æä¾›äº†ä¸åŸç”Ÿäº‹ä»¶ç›¸åŒçš„æ¥å£ä¸è¿‡å®ƒä»¬å±è”½äº†åº•å±‚æµè§ˆå™¨çš„ç»†èŠ‚å·®å¼‚ä¿è¯äº†è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚å¦å¤–æœ‰æ„æ€çš„æ˜¯ React å¹¶æ²¡æœ‰ç›´æ¥å°†äº‹ä»¶é™„ç€åˆ°å­å…ƒç´ ä¸Šè€Œæ˜¯ä»¥å•ä¸€äº‹ä»¶ç›‘å¬å™¨çš„æ–¹å¼å°†æ‰€æœ‰çš„äº‹ä»¶å‘é€åˆ°é¡¶å±‚è¿›è¡Œå¤„ç†ã€‚è¿™æ · React åœ¨æ›´æ–° DOM çš„æ—¶å€™å°±ä¸éœ€è¦è€ƒè™‘å¦‚ä½•å»å¤„ç†é™„ç€åœ¨ DOM ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨æœ€ç»ˆè¾¾åˆ°ä¼˜åŒ–æ€§èƒ½çš„ç›®çš„

åŒºåˆ«ï¼š
1. å¯¹äºæ—¶é—´åç§°å‘½åæ–¹å¼ï¼ŒåŸç”Ÿæ—¶é—´ä¸ºå…¨å°å†™ï¼Œreact äº‹ä»¶é‡‡ç”¨å°é©¼å³°
2. å¯¹äºæ—¶é—´å‡½æ•°å¤„ç†è¯­æ³•ï¼ŒåŸç”Ÿäº‹ä»¶ä¸ºå­—ç¬¦ä¸²ï¼Œreact äº‹ä»¶ä¸ºå‡½æ•°ï¼›
3. react äº‹ä»¶ä¸èƒ½é‡‡ç”¨return false çš„æ–¹å¼æ¥é˜»æ­¢æµè§ˆå™¨çš„é»˜è®¤è¡Œä¸ºï¼Œè€Œå¿…é¡»è¦æ˜ç¡®çš„è°ƒç”¨preventDefault(ï¼‰æ¥é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚
åˆæˆäº‹ä»¶æ˜¯ react æ¨¡æ‹ŸåŸç”Ÿçš„ DOM äº‹ä»¶æ‰€æœ‰èƒ½åŠ›çš„ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œå…¶ä¼˜ç‚¹å¦‚ä¸‹ï¼š
1. å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼Œæ›´å¥½çš„è·¨å¹³å°
2. å°†äº‹ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ï¼Œé¿å…é¢‘ç¹çš„æ–°å¢è¯­åˆ é™¤
3. æ–¹ä¾¿ react ç»Ÿä¸€ç®¡ç†å’Œäº‹åŠ¡æœºåˆ¶
4. äº‹ä»¶çš„æ‰§è¡Œé¡ºåºä¸ºåŸç”Ÿäº‹ä»¶çº¿æ‰§è¡Œï¼Œåˆæˆäº‹ä»¶åæ‰§è¡Œï¼Œåˆæˆäº‹ä»¶ä¼šå†’æ³¡ç»‘å®šåˆ° document ä¸Šï¼Œæ‰€ä»¥å°½é‡é¿å…åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æ··ç”¨ï¼Œå¦‚æœåŸç”Ÿäº‹ä»¶é˜»æ­¢å†’æ³¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆæˆäº‹ä»¶ä¸æ‰§è¡Œï¼Œå› ä¸ºéœ€è¦å†’æ³¡åˆ° document ä¸Šåˆæˆäº‹ä»¶æ‰ä¼šæ‰§è¡Œã€‚
react æ€ä¹ˆåšäº‹ä»¶ä»£ç†ï¼ŒåŸç†æ˜¯å•¥
1. react åŸºäº virtual dom å®ç°äº†ä¸€ä¸ª syntheticEvent å±‚ï¼ˆåˆæˆäº‹ä»¶å±‚ï¼‰ï¼Œå®šä¹‰çš„äº‹ä»¶å¤„ç†å™¨ä¼šæ¥å—åˆ°ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡çš„å®ä¾‹ï¼Œå®ƒç¬¦åˆ w3c æ ‡å‡†ï¼Œä¸”ä¸åŸç”Ÿçš„æµè§ˆå™¨äº‹ä»¶æ‹¥æœ‰åŒæ ·çš„å€Ÿå£ï¼Œæ”¯æŒå†’æ³¡æœºåˆ¶ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½ä¼šç»‘å®šåˆ°æœ€å¤–å±‚ä¸Šã€‚

## hookç›¸å…³
**å†™è¿‡ä»€ä¹ˆ hookså—**
1. useErrorBoundary

**hook ä¸­æŒä¹…åŒ–æ–¹å¼**
1. useRef

**useState**
1. å¯ä»¥è¿›è¡Œå‡½æ•°å¼æ›´æ–°
```js
const [count, changeCount] = useState(0)

changeCount(prevCount => prevCount + 1)
```

**useRef**
1. æŒ‚è½½ dom èŠ‚ç‚¹
2. æ¨¡æ‹Ÿç±»ç»„ä»¶çš„ thisï¼Œå……å½“æŒä¹…åŒ–æ•°æ®å¯¹è±¡
```js
import React, {useRef, useEffect} from 'react';

// 1. æŒ‚è½½domèŠ‚ç‚¹
export default function UseRef() {
   const container = useRef(null)
   console.log('container', container) // ç¬¬ä¸€æ¬¡æ‹¿ä¸åˆ°

   useEffect(() => {
      console.log('container', container) // current å±æ€§å¼•ç”¨ç€è™šæ‹Ÿ DOM èŠ‚ç‚¹ 
   }, [])

   return (<button ref={container}> Refå®¹å™¨ </button>)
}
// 2. æ¨¡æ‹Ÿç±»ç»„ä»¶çš„thisï¼Œå……å½“æŒä¹…åŒ–æ•°æ®å¯¹è±¡
export default function UseRef() {
   const container = useRef(false)
   useEffect(() => {
      if(container.current) {
         console.log('æ¨¡æ‹Ÿ componentDidUpdateï¼Œå³é™¤äº†åˆå§‹åŒ–ï¼Œä¹‹åçš„æ›´æ–°è¿›åˆ°è¿™é‡Œ')
      } else {
         container.current = true 
      }
    })
    return (<button> Refå®¹å™¨ </button>)
} 
```

**useCallback(fn, depArrs)**
1. ç›®çš„ï¼šçˆ¶ç»„ä»¶æ›´æ–°ä¸å¸Œæœ›å­ç»„ä»¶æ›´æ–°
2. è§£å†³ï¼šçˆ¶ç»„ä»¶ç”¨useCallbackåŒ…è£¹ä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°ï¼ŒuseCallbackæŒä¹…åŒ–ç¼“å­˜åŒ…è£¹çš„å‡½æ•°
3. è¿”å›å‡½æ•°
4. useCallback å¯ä»¥å¯¹å‡½æ•°è¿›è¡Œç¼“å­˜ï¼Œ ä¿è¯ onChange ä¸ä¼šéšç€ç»„ä»¶æ›´æ–°è€Œæ”¹å˜å¼•ç”¨

**memo(fn, validFn)**
1. propsä¸å˜åŒ–ï¼Œä¸é‡æ–°æ¸²æŸ“
2. æ¨¡æ‹Ÿ shouldComponentUpdate
3. validFn æ”¾ä¸ª shallowEqual
4. è¿”å›ä¸€ä¸ªç»„ä»¶
5. åŒ…è£¹ç»„ä»¶ï¼Œç»„ä»¶å±‚é¢
6. memo ä¼šé»˜è®¤å¯¹æ‰€æœ‰ props è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸å‘ç”Ÿå˜åŒ–åˆ™ä¸æ›´æ–°ç»„ä»¶ï¼Œé¿å…çˆ¶çº§å¼•èµ·çš„å­çº§æ¸²æŸ“

**useMemo**
1. å’Œvueä¸­componentå·®ä¸å¤šï¼Œç”¨æ³•å¦‚useCallback
2. è¿”å›å‡½æ•°çš„è°ƒç”¨ç»“æœ

**useContext**
1. hooks ç‰ˆæœ¬çš„ context 
2. Context.Provider åŒ…è£¹åçš„å­ç»„ä»¶èƒ½æ‹¿åˆ° context
3. ä¸å—ç»„ä»¶ä¼˜åŒ–çš„å½±å“
4. ä½¿ç”¨
```js
import React, { useState, createContext, useContext } from 'react'

// 1. åˆ›å»ºå…±äº«æ•°æ®æºå¯¹è±¡
const Context = createContext();

// 2. çˆ¶ç»„ä»¶ä½¿ç”¨ Provider åŒ…è£¹æ‰€æœ‰åä»£ç»„ä»¶
export default function Parent() {
   const [count, changeCount] = useState(0)
   const store = {
      count,
      changeCount
   }
   return (
      <Context.Provider value={store}>
         <button onClick={()=>changeCount(count + 1)}>åŠ ä¸€{count}</button>
         <Sub1 />
      </Context.Provider>
   )
}

// 3. å­ç»„ä»¶ä½¿ç”¨ useContext è°ƒç”¨æ–¹æ³•
function Sub1(){
   const ctx = useContext(Context)
   return <>
      <button onClick={()=>ctx.changeCount(c => c + 1)}>
         Sub1 èƒ½é€šè¿‡ Context è®¿é—®æ•°æ®æº { ctx.count }
      </button>
   </>
} 
```

**useImperativeHandle + forwardRef**
1. é™åˆ¶çˆ¶ç»„ä»¶è®¿é—®çš„èŒƒå›´
```js

```

**è‡ªå®šä¹‰hook**
1. ä¸€èˆ¬ä½¿ç”¨å®˜æ–¹çš„hookäºŒæ¬¡å®ç°

**useSelector useDispatch**

**useLocation, useHistory, useParams**

## react ä¸­çš„æ·±åº¦ä¼˜å…ˆéå†
ç¬¦åˆæ¡ä»¶A æˆ–è€…ç¬¦åˆæ¡ä»¶Båˆ™ä¸ä¼šéå†å…¶å­èŠ‚ç‚¹ï¼Œè€Œç›´æ¥åˆ¤æ–­æ˜¯å¦æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œåˆ™å›åˆ°æœ‰å…„å¼ŸèŠ‚ç‚¹çš„ç›´ç³»çˆ¶èŠ‚ç‚¹ï¼Œé‡æ–°å¼€å§‹å¤–å±‚çš„ while å¾ªç¯
```js 
while(node !== null) {
  if(node.tag ç¬¦åˆæ¡ä»¶A) {
    // æ“ä½œA 
  } else if (node.tag ç¬¦åˆæ¡ä»¶B) {
    // æ“ä½œB 
  } else if (node.child !== null) {
    node.child.return = node 
    node = node.child 
    continue 
  }

  if(node === nodeRoot) {
    return 
  }

  while (node.sibling === null) {
    if(node.return === null || node.return === nodeRoot) {
      return
    }
    node = node.return 
  }

  node.sibling.return = node.return 
  node = node.sibling
}
```

## DIFF
**å•èŠ‚ç‚¹diff**
- åˆ¤æ–­æ˜¯å¦æœ‰è€çš„fiberèŠ‚ç‚¹ --ã€‹æ²¡æœ‰ç›´æ¥ç”Ÿæˆæ–°fiber 
- åˆ¤æ–­keyæ˜¯å¦æœ‰ç›¸åŒ  --ã€‹ä¸åŒç›´æ¥åˆ é™¤ å†æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè€fiber 
- åˆ¤æ–­typeæ˜¯å¦ç›¸åŒ  --ã€‹ä¸åŒç›´æ¥åˆ é™¤å½“å‰fiberåœ¨å†…çš„æ‰€æœ‰è€çš„fiber --ã€‹ç”Ÿæˆæ–°çš„fiber 
- åˆ é™¤å‰©ä¸‹çš„å…¶ä»–è€çš„fiber --ã€‹æœç”¨è€fiberå¹¶è¿”å›

**å¤šèŠ‚ç‚¹diff**
1. ç¬¬ä¸€è½®éå†
- å¦‚æœkeyä¸åŒåˆ™ç›´æ¥ç»“æŸæœ¬è½®å¾ªç¯
- newChildrenæˆ–oldFiberéå†å®Œï¼Œç»“æŸæœ¬è½®å¾ªç¯
- keyç›¸åŒè€Œtypeä¸åŒï¼Œæ ‡è®°è€çš„oldFiberä¸ºåˆ é™¤ï¼Œç»§ç»­å¾ªç¯
- keyç›¸åŒè€Œtypeä¹Ÿç›¸åŒï¼Œåˆ™å¯ä»¥æœç”¨è€oldFiberèŠ‚ç‚¹ï¼Œç»§ç»­å¾ªç¯ 

2. ç¬¬äºŒè½®éå†
- newChildrenéå†å®Œè€ŒoldFiberè¿˜æœ‰ï¼Œéå†å‰©ä¸‹æ‰€æœ‰çš„oldFiberæ ‡è®°ä¸ºåˆ é™¤ï¼ŒDIFFç»“æŸ
- oldFiberéå†å®Œï¼Œè€ŒnewChildrenè¿˜æœ‰ï¼Œå°†å‰©ä¸‹çš„newChildrenæ ‡è®°ä¸ºæ’å…¥ï¼ŒDIFFç»“æŸ
- newChildrenå’ŒoldFiberéƒ½æ²¡æœ‰å®Œæˆï¼Œåˆ™è¿›è¡ŒèŠ‚ç‚¹ç§»åŠ¨çš„é€»è¾‘

3. ç¬¬ä¸‰è½®
- å¤„ç†èŠ‚ç‚¹ç§»åŠ¨çš„æƒ…å†µ

4. ä¾‹å­
è€ï¼šA-->B-->C-->D-->E-->F 
æ–°ï¼šA-->C-->E-->B-->G-->D 
- ç¬¬ä¸€è½®æ¯”è¾ƒAå’ŒAï¼Œç›¸åŒå¯ä»¥å¤ç”¨ï¼Œæ›´æ–°ï¼Œç„¶åæ¯”è¾ƒBå’ŒCï¼Œkeyä¸åŒç›´æ¥è·³å‡ºç¬¬ä¸€ä¸ªå¾ªç¯
- æŠŠå‰©ä¸‹çš„oldFiberæ”¾å…¥existingChildrenè¿™ä¸ªmapä¸­
- ç„¶åå£°æ˜ä¸€ä¸ªlastPlacedIndexå˜é‡ï¼Œè¡¨ç¤ºä¸éœ€è¦ç§»åŠ¨çš„è€èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œé»˜è®¤ä¸º0
- ç»§ç»­å¾ªç¯å‰©ä¸‹çš„è™šæ‹ŸdomèŠ‚ç‚¹ï¼Œä»Cå¼€å§‹
- å¦‚æœèƒ½åœ¨mapä¸­æ‰¾åˆ°ç›¸åŒkeyç›¸åŒtypeçš„èŠ‚ç‚¹åˆ™å¯ä»¥å¤ç”¨è€fiberï¼Œå¹¶æŠŠæ­¤fiberä»mapä¸­åˆ é™¤
- å¦‚æœåœ¨mapä¸­æ‰¾ä¸åˆ°ç›¸åŒkeyç›¸åŒtypeçš„èŠ‚ç‚¹åˆ™åˆ›å»ºæ–°çš„fiberèŠ‚ç‚¹
- å¦‚æœæ˜¯å¤ç”¨è€çš„fiberï¼Œåˆ™åˆ¤æ–­è€fiberçš„ç´¢å¼•æ˜¯å¦å°äºlastPlacedIndex
- å¦‚æœå°äºlastPlacedIndexåˆ™éœ€è¦ç§»åŠ¨è€fiberï¼ŒlastPlacedIndexä¸å˜
- å¦‚æœå¤§é›¨lastPlacedIndexåˆ™ä¸éœ€è¦ç§»åŠ¨è€fiberï¼Œæ›´æ–°lastPlaecdIndexä¸ºè€fiberçš„index 
- è™šæ‹ŸDOMå¾ªç¯ç»“æŸå§mapä¸­æ‰€æœ‰å‰©ä¸‹çš„fiberå…¨éƒ¨æ ‡è®°ä¸ºåˆ é™¤

## ReactDOM.render(element, container, callback) æµç¨‹

1. åˆ›å»º react root 
2. åˆ›å»º fiber root 
3. åˆ›å»º root fiber 
4. new FiberNode ä½œä¸º RootFiber è¿”å›
5. å°† RootFiber æ”¾åˆ° root å¯¹è±¡çš„ current å±æ€§ï¼Œ container æ”¾åˆ° containerInfo å±æ€§ï¼Œå¹¶åˆå§‹åŒ–å…¶ä»–å±æ€§
6. å°† RootFiber å¯¹è±¡çš„ stateNode å±æ€§è®¾ç½®ä¸º FiberRoot 
7. è¿”å› FiberRoot 
8. å°† FiberRoot æ”¾åˆ° ReactRoot å®ä¾‹çš„ _internalRoot ä¸Š
9. è¿”å› ReactRoot 
10. å°†ç¬¬ä¸‰ä¸ªå‚æ•° callback çš„æ‰§è¡Œç¯å¢ƒç»‘å®šä¸ºä¼ç»„ä»¶çš„ FiberRoot å¯¹è±¡
11. å¼€å§‹è°ƒç”¨ ReactRoot å®ä¾‹çš„ render å‡½æ•°ï¼Œä¼ å…¥ ReactDOM.renderçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ç¬¬ä¸‰ä¸ªå‚æ•°
12. åˆ›å»º ReactWork å¯¹è±¡å®ä¾‹ï¼Œå°†ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥è¿™ä¸ªå®ä¾‹çš„ _callbacks å±æ€§ä¸Šï¼Œåœ¨ container æ›´æ–°æäº¤é˜¶æ®µå®Œæˆä¹‹åçš„æ‰§è¡Œå›è°ƒ
13. å¼€å§‹å¤„ç† container çš„ fiber 
14. è®¡ç®— container å¯¹åº” fiber çš„åˆ°æœŸæ—¶é—´ expirationTime 
15. ä¸º container çš„ fiber è®¾ç½® context 
16. è°ƒç”¨ scheduleRootUpdate å¼€å§‹è¿›å…¥å¯¹ root çš„æ›´æ–°è°ƒåº¦é˜¶æ®µ
17. åˆ©ç”¨åˆ°æœŸæ—¶é—´åˆ›å»ºæ›´æ–°å™¨ï¼šcreateUpdate 
18. å°†ç¬¬ä¸€ä¸ª react ç»„ä»¶ app ä½œä¸ºæ›´æ–°å™¨çš„ payload 
19. å°†ç¬¬ä¸‰ä¸ªå‚æ•°å›è°ƒå‡½æ•°æ‰§è¡Œå™¨ä½œä¸ºæ›´æ–°å™¨çš„ callback 
20. åˆ·æ–°å‰¯ä½œç”¨ï¼Œä¸commitRootç›¸å…³
21. å°†æ›´æ–°å™¨åŠ å…¥ container çš„ fiber ä¸Šçš„æ›´æ–°é˜Ÿåˆ—ä¸­ enqueueUpdate 
22. scheduleWork(current, expirationTime) æ­£å¼è¿›å…¥å¯¹ container çš„fiberæ ‘çš„å¾ªç¯æ›´æ–°è°ƒåº¦é˜¶æ®µ

23. å¼€å§‹å¯¹ fiber æ ‘æ›´æ–°ä»»åŠ¡è¿›è¡Œè°ƒåº¦
24. å°†å½“å‰æ›´æ–°ä»»åŠ¡å¯¹åº”çš„åˆ°æœŸæ—¶é—´ä¸å½“å‰ fiber ä¸Šå­˜å‚¨çš„æœ€é«˜ä¼˜å…ˆçº§æ›´æ–°ä»»åŠ¡åˆ°æœŸæ—¶é—´ç›¸æ¯”ï¼Œæ¥æ›´æ–° fiber.expirationTimeã€‚ä»å‘ç”Ÿæ›´æ–°ä»»åŠ¡çš„ fiber å¼€å§‹å¾€ä¸Šéå†æ›´æ–°fiberæ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„ childExpirationTime, è¿™ä¸ªå€¼å¯¹åº”ç€è¿™ä¸ª fiber å­æ ‘ä¸Šä¼˜å…ˆçº§æœ€é«˜çš„æ›´æ–°ä»»åŠ¡çš„åˆ°æœŸæ—¶é—´ã€‚current-fiber ä¸ workingprogress-fiberéƒ½ä¼šè¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚æœ€ç»ˆéå†åˆ°rootfiberä¹‹åï¼Œç»“æŸéå†å¹¶è¿”å›fiber.stateNode
25. å¦‚æœå½“å‰           ä¸å¤„äºrenderRootä¸commitRootçš„é˜¶æ®µï¼Œå¹¶ä¸”ä¹‹å‰æœ‰æ›´æ–°ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œå¹¶ä¸”å½“å‰çš„æ›´æ–°ä»»åŠ¡çš„åˆ°æœŸæ—¶é—´æ¯”è®¡åˆ’æ‰§è¡Œçš„æ›´æ–°ä»»åŠ¡åˆ°æœŸæ—¶é—´çš„ä¼˜å…ˆçº§é«˜ï¼Œåˆ™è®°å½•ä¸‹æ‰“æ–­è®¡åˆ’ä»»åŠ¡çš„è¿™ä¸ªfiberåˆ°interruptedByä¸Šï¼Œç„¶åè°ƒç”¨resetStacké‡ç½®æ ˆã€‚
26. åˆ©ç”¨ expirationTime æ¥æ›´æ–° fiberRoot ä¸Šè®°å½•çš„æ‰€æœ‰å­èŠ‚ç‚¹æ›´æ–°ä»»åŠ¡åˆ°æœŸæ—¶é—´çš„åŒºé—´[earliestPendingTIme, lastestPendingTime], è¿™ä¸ªåŒºé—´æ˜¯rootæ ‘ä¸Šçš„è¿˜æœªæ›´æ–°çš„ä»»åŠ¡åˆ°æœŸæ—¶é—´çš„åŒºé—´
27. å½“å‰å‘ç”Ÿçš„æ›´æ–°ä»»åŠ¡çš„åˆ°æœŸæ—¶é—´expirationTimeä¸fiberRootä¸Šæ›´æ–°ä»»åŠ¡åˆ°æœŸæ—¶é—´[earliestPendingTIme, lastestPendingTime]æ¯”è¾ƒï¼Œå¦‚æœè½åœ¨åŒºé—´å†…ï¼Œåˆ™ä¸éœ€è¦ä¿®æ”¹åŒºé—´ï¼›å¦åˆ™æ›´æ”¹åŒºé—´çš„æŸä¸€ä¸ªè¾¹ç•Œ
28. è®¾ç½® root.nextExplrationTimeToWorkOn: å¦‚æœearliesPendingTime !== 0 å³å­˜åœ¨éœ€è¦æ›´æ–°çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆ nextExpirationTimeToWorkOnä¸ºearliestPendingTimeã€‚å¦åˆ™è¡¨ç¤ºä¸å­˜åœ¨éœ€è¦æ›´æ–°çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆå¦‚æœlatestPingedTime !== 0 å³å­˜åœ¨éœ€è¦æ¸²æŸ“ä¸ºsuspendç»„ä»¶ï¼Œé‚£ä¹ˆnextExpirationTimeToWorkOnä¸ºlastestPingedTimeã€‚å¦åˆ™å°†å½“å‰æ›´æ–°ä»»åŠ¡åˆ°æœŸæ—¶é—´ä¸[earliestSuspendedTime,lastestSuspendTime]ã€‚è®¾ç½® root.expirationTimeToWorkOnä¼˜å…ˆçº§æœ€é«˜çš„åˆ°æœŸæ—¶é—´ã€‚
29. å¦‚æœå½“å‰ä¸å¤„äºrenderRootä¸commitRootå‡½æ•°æ‰§è¡Œé˜¶æ®µæˆ–è€…å¤„äºcommitRooté˜¶æ®µæˆ–è€…ä¸‹æ¸²æŸ“çš„æ˜¯å…¶ä»–rootï¼Œåˆ™è°ƒç”¨requestWorkå°±å¼€å§‹å¯¹rootFiberè¿›è¡Œè°ƒåº¦

## react æ•°æ®ç»“æ„
1. FiberRootNode 
```js
function FiberRootNode(containerInfo, tag, hydrate) {
  this.tag = tag // LegacyRoot, BlockingRoot, ConcurrentRoot 
  this.containerINfo = containerInfo // rootèŠ‚ç‚¹ï¼Œrenderå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°
  this.current = null // current: Fiber å¯¹è±¡ï¼Œå¯¹åº”çš„æ˜¯ root èŠ‚ç‚¹ï¼Œå³æ•´ä¸ªåº”ç”¨æ ¹å¯¹è±¡
  this.finishedWork = null // åœ¨commité˜¶æ®µåªä¼šå¤„ç†è¯¥å€¼å¯¹åº”çš„ä»»åŠ¡
}

```

> FiberRoot --> rootFiber --> App
> FiberRoot åœ¨æ•´ä¸ªåº”ç”¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªï¼ŒRootFiberå¯ä»¥æœ‰å¤šä¸ª(å¯ä»¥å†™å¤šä¸ª, ReactDom.render()æ–¹æ³•)

2. FiberNode 
```js
function FiberNode() {
  // instance 
  this.tag = tag; // å½“å‰ Fiber çš„ç±»å‹ï¼šClassComponent FunctionComponent HostComponent 
  this.key = key 
  this.elementType = null 
  this.type = null 
  this.stateNode = null 
  
  // fiber é“¾è¡¨ 
  this.return = null // æŒ‡å‘çˆ¶çº§ç»„ä»¶
  this.child = null // æŒ‡å‘å­çº§fiber 
  this.sibling = null // æŒ‡å‘å…„å¼Ÿfiber  

  this.ref = null 

  // æ›´æ–°ç›¸å…³
  this.pendingProps = pendingProps  // å°†è¦æ‰§è¡Œæ›´æ–°çš„å±æ€§
  this.memoizedProps = null // ä¸Šä¸€æ¬¡æ›´æ–°çš„ props 
  this.updateQueue = null // æ›´æ–°é˜Ÿåˆ—
  this.memoizedState = null // ä¸Šä¸€æ¬¡æ›´æ–°çš„State 
  this.dependencies = null // ä¸€ä¸ªåˆ—è¡¨å­˜åœ¨fiberä¾èµ–çš„contextsï¼Œevents 

  // TypedOfMode, StrictNode / COncurrentMode 
  this.mode = mode 

  // Effects 
  this.flags = NoFlags // å½“å‰ fiber é˜¶æ®µéœ€è¦è¿›è¡Œä»»åŠ¡ï¼ŒåŒ…æ‹¬ï¼šå ä½ï¼Œæ›´æ–°ï¼Œåˆ é™¤ç­‰
  this.nextEffect = null // å•é“¾è¡¨ç”¨æ¥å¿«é€ŸæŸ¥æ‰¾ä¸‹ä¸€ä¸ªside Effect 
  this.firstEffect = null // å­æ ‘ä¸­ç¬¬ä¸€ä¸ª side effect 
  this.lastEffect = null // å­æ ‘ä¸­æœ€åä¸€ä¸ª side effect 

  // å’Œ lanes ä¼˜å…ˆçº§ç›¸å…³
  this.lanes = NoLanes // è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯å¦éœ€è¦æ›´æ–°
  this.childLanes = NoLanes // è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ˜¯å¦éœ€è¦æ›´æ–°

  // currentæ ‘å’ŒworkInProgressæ ‘ä¸­èŠ‚ç‚¹ç›¸äº’å…³è”çš„å±æ€§
  // å¯ä»¥ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°è¿˜æ˜¯åˆ›å»ºï¼Œæœ‰å€¼è¡¨ç¤ºæ›´æ–°ï¼Œåä¹‹åˆ™éœ€è¦åˆ›å»º
  this.alternate = null;
}
```

## render æµç¨‹
renderçš„æ—¶å€™é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªfiberRootï¼Œåˆ›å»ºä¸€ä¸ªworkInProcessï¼ˆæ­£åœ¨å†…å­˜ä¸­æ„å»ºçš„fiberæ ‘ï¼‰ï¼Œbenginworkï¼ŒcompleteWork

## fiberåŒç¼“å­˜è§£å†³ä»€ä¹ˆé—®é¢˜
å‡ºç°æ›´æ–°çš„æ—¶å€™é¦–å…ˆåœ¨å†…å­˜ä¸­ä¿®æ”¹è¿™é¢—è™šæ‹Ÿçš„æ ‘ï¼Œæ›´æ–°å®Œæˆä¹‹åï¼Œå†commitRootæ›´æ–°åˆ°ç”¨æˆ·ç•Œé¢

## ä¼˜å…ˆçº§
1. ä»€ä¹ˆæ—¶å€™åˆ†é…ä¼˜å…ˆçº§ï¼Ÿ åˆ›å»ºfiberNodeæ—¶
2. LanePriorityï¼ˆè°ƒå’Œå™¨é‡Œé¢ï¼‰ schedulePriorityï¼ˆè°ƒåº¦å™¨é‡Œé¢ï¼‰ ReactPriorityLevelï¼ˆè°ƒå’Œå™¨é‡Œé¢ï¼‰
3. schedulePriority å’Œ LanePriority

## scheduler è°ƒåº¦ç®¡ç†
1. ä¸¤å¤§å·¥ä½œä»»åŠ¡
2. ä»»åŠ¡å¦‚ä½•ä¸­æ–­ï¼Œå¦‚ä½•æ‰§è¡Œ
æ ¹æ®ä¼˜å…ˆçº§æƒ…å†µä¸­æ–­ï¼Œ
3. requestIdleCallback
4. messageChannel ä½œç”¨
- ç”Ÿæˆæµè§ˆå™¨EventLoopä¸­çš„ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå®ç°å°†ä¸»çº¿ç¨‹è¿˜ç»™æµè§ˆå™¨ï¼Œä»¥ä¾¿æµè§ˆå™¨æ›´æ–°é¡µé¢
- æµè§ˆå™¨æ›´æ–°é¡µé¢åèƒ½å¤Ÿç»§ç»­æ‰§è¡Œæœªå®Œæˆçš„Schedulerä¸­çš„ä»»åŠ¡
- ä¸ç”¨å¾®ä»»åŠ¡è¿­ä»£çš„åŸå› æ˜¯ï¼Œå¾®ä»»åŠ¡å°†åœ¨é¡µé¢æ›´æ–°å‰å…¨éƒ¨æ‰§è¡Œå®Œï¼Œè¾¾ä¸åˆ°ä¸»çº¿ç¨‹è¿˜ç»™æµè§ˆå™¨çš„ç›®çš„
- é€‰æ‹© MessageChannel  çš„åŸå› æ˜¯å› ä¸º setTimeout(fn, 0)æ‰€åˆ›å»ºçš„å®ä»»åŠ¡è‡³å°‘4msçš„æ‰§è¡Œæ—¶å·®
5. shouldYield
6. taskQueue å°é¡¶å †

## concurrentæ¨¡å¼ 
å°†æ¸²æŸ“å·¥ä½œåˆ†è§£ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œå¯¹ä»»åŠ¡è¿›è¡Œæš‚åœå’Œæ¢å¤æ“ä½œä»¥é¿å…é˜»å¡æµè§ˆå™¨ã€‚è¿™æ„å‘³ç€Reactå¯ä»¥å†æäº¤ä¹‹å‰å¤šæ¬¡è°ƒç”¨æ¸²æŸ“é˜¶æ®µç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œæˆ–è€…åœ¨ä¸æäº¤çš„æƒ…å†µä¸‹è°ƒç”¨ä»–ä»¬
æ•´ä¸ªschedulerçš„ä»»åŠ¡è°ƒåº¦ï¼Œæ—¶é—´åˆ‡ç‰‡ï¼Œä»»åŠ¡ä¸­æ–­åŠæ¢å¤éƒ½ä¾èµ–äºconcurentæ¨¡å¼åŠFiberæ•°æ®ç»“æ„


